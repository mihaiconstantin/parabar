<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparison with other approaches • parabar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparison with other approaches">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parabar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/comparison.html">Comparison with other approaches</a></li>
    <li><a class="dropdown-item" href="../articles/foreach.html">Using `parabar` with `foreach`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mihaiconstantin/parabar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Comparison with other approaches</h1>
                        <h4 data-toc-skip class="author">Mihai
Constantin</h4>
            
            <h4 data-toc-skip class="date">17 November, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mihaiconstantin/parabar/blob/v1.4.0/vignettes/comparison.Rmd" class="external-link"><code>vignettes/comparison.Rmd</code></a></small>
      <div class="d-none name"><code>comparison.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The goal of this article is to compare the <a href="https://parabar.mihaiconstantin.com" class="external-link"><code>parabar</code></a>
package with other packages available on <code>CRAN</code> that provide
<strong>progress tracking</strong> functionality for parallelized
<code>R</code> code. While <code>parabar</code> provides more features,
the comparisons and benchmarks presented in this article are
specifically aimed at its progress-tracking functionality. The remainder
of this article is organized as follows. I start with a section on how
<code>parabar</code> tackles progress tracking. Then, I iterate over
other packages that provide progress tracking for parallel tasks and
briefly discuss the approaches these packages employ. Next, I provide
<em>rough</em> benchmarks comparing the added overhead of these
progress-tracking approaches to the baseline scenario of using the
built-in package <a href="https://stat.ethz.ch/R-manual/R-devel/library/parallel/html/00Index.html" class="external-link"><code>parallel</code></a>
(i.e., without progress tracking).</p>
</div>
<div class="section level2">
<h2 id="progress-tracking-with-parabar">Progress tracking with <code>parabar</code><a class="anchor" aria-label="anchor" href="#progress-tracking-with-parabar"></a>
</h2>
<p>The <code>parabar</code> package is aimed at two audiences: (1)
end-users who intend to use our package in scripts executed in an
interactive <code>R</code> session (i.e., see <a href="https://parabar.mihaiconstantin.com/#users" class="external-link">this resource</a>),
and (2) <code>R</code> package developers (i.e., see <a href="https://parabar.mihaiconstantin.com/#developers" class="external-link">this
resource</a>). The <strong>two key concepts</strong> behind
<code>parabar</code> are <em><a href="https://parabar.mihaiconstantin.com/#backends" class="external-link">backends</a></em>
and <em><a href="https://parabar.mihaiconstantin.com/#contexts" class="external-link">contexts</a></em>.
Below I describe these concepts in more detail and demonstrate how they
can be used to add new functionality to <code>parabar</code>. This
example that follows is focused on progress tracking, and it represents
but one example of what is possible. You may check out the <a href="https://raw.githubusercontent.com/mihaiconstantin/parabar/main/inst/design/parabar-design.drawio.svg" class="external-link">UML
diagram</a> for a more detailed overview of the package design.</p>
<div class="section level3">
<h3 id="backends">Backends<a class="anchor" aria-label="anchor" href="#backends"></a>
</h3>
<p>A <a href="https://parabar.mihaiconstantin.com/reference/Backend.html" class="external-link">backend</a>
is an <a href="https://r6.r-lib.org" class="external-link"><code>R6</code></a> class wrapper
around a <em>cluster</em> object obtained from the
<code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">?parallel::makeCluster</a></code> function. The role of a backend is
to abide by a standardized way of interacting with <code>parallel</code>
clusters by implementing the <code><a href="../reference/BackendService.html">?BackendService</a></code> interface. In
a nutshell, the <code><a href="../reference/BackendService.html">?BackendService</a></code> interface defines the set
of operations that a backend can perform on a cluster object (e.g.,
exporting variables, evaluating expressions, running parallel tasks
etc.). Backends can be of different types. Currently,
<code>parabar</code> supports <em>synchronous</em> and
<em>asynchronous</em> backends. A <a href="https://parabar.mihaiconstantin.com/reference/SyncBackend.html" class="external-link">synchronous
backend</a> manages a cluster created in the same process as the backend
instance itself. An <a href="https://parabar.mihaiconstantin.com/reference/AsyncBackend.html" class="external-link">asynchronous
backend</a>, on the other hand, manages a cluster created in a
background <code>R</code> session (i.e., created via the <a href="https://callr.r-lib.org" class="external-link"><code>callr</code></a> package). In
principle, it is possible to extend <code>parabar</code> with other
types of backends (e.g., backends that are created on a remote server
and managed over <code>SSH</code>).</p>
</div>
<div class="section level3">
<h3 id="contexts">Contexts<a class="anchor" aria-label="anchor" href="#contexts"></a>
</h3>
<p>The <code>parabar</code> package is designed with extensibility in
mind, which brings us to the second key concept, namely,
<strong>contexts</strong>. New functionality can be implemented as
<em>custom contexts</em> that extend the <em>base context</em> class. In
simple terms, a <em>context</em> is an <code>R6</code> wrapper class for
a backend instance, with the role of determining how the backend
operations defined by the <code><a href="../reference/BackendService.html">?BackendService</a></code> interface should
be executed. The base <code><a href="../reference/Context.html">?Context</a></code> (i.e., that all other custom
contexts extend) implements the same <code><a href="../reference/BackendService.html">?BackendService</a></code> as the
backend instance and simply forwards its method calls to the backend
instance, which in turn interacts with the cluster. For example, calling
the <code>sapply</code> method on a base <code><a href="../reference/Context.html">?Context</a></code> instance
will forward the call to the corresponding <code>sapply</code> method on
the wrapped <code><a href="../reference/Backend.html">?Backend</a></code> instance, which contains the actual
implementation details for interacting with the cluster object (e.g.,
via <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parSapply</a></code>).</p>
</div>
<div class="section level3">
<h3 id="progress-tracking-functionality">Progress tracking functionality<a class="anchor" aria-label="anchor" href="#progress-tracking-functionality"></a>
</h3>
<p>New functionality can be added by creating custom contexts that
extends the base context. Custom contexts can then override and decorate
the methods of the base context to provide the desired functionality.
The <code><a href="../reference/ProgressTrackingContext.html">?ProgressTrackingContext</a></code> is an example of such a custom
context that decorates the <code>sapply</code> method to add progress
tracking. This specific context works by overriding the
<code>sapply</code> method of the base <code><a href="../reference/Context.html">?Context</a></code> class to
add the necessary functionality for progress tracking. More
specifically, if we take a look at the [source code] (<a href="https://github.com/mihaiconstantin/parabar/blob/1164f76e4b8c21a983d15b5c23ecad25bd667eaf/R/Context.R#L201-L217" class="external-link uri">https://github.com/mihaiconstantin/parabar/blob/1164f76e4b8c21a983d15b5c23ecad25bd667eaf/R/Context.R#L201-L217</a>)
for the <code>sapply</code> method of the base <code><a href="../reference/Context.html">?Context</a></code>
(i.e., at commit <a href="https://github.com/mihaiconstantin/parabar/tree/1164f76e4b8c21a983d15b5c23ecad25bd667eaf" class="external-link"><code>1164f76</code></a>)
we see the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ...</span></span>
<span></span>
<span><span class="va">sapply</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">fun</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Consume the backend API.</span></span>
<span>    <span class="va">private</span><span class="op">$</span><span class="va">.backend</span><span class="op">$</span><span class="fu">sapply</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, fun <span class="op">=</span> <span class="va">fun</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ...</span></span></code></pre></div>
<p>This method simply passes its arguments to the <code>sapply</code>
method of the wrapped backend instance (i.e., stored in the private
field <code>.backend</code>). Note that the <code><a href="../reference/Backend.html">?Backend</a></code> and
the <code><a href="../reference/Context.html">?Context</a></code> classes share a <code>sapply</code> method
since both implement the <code><a href="../reference/BackendService.html">?BackendService</a></code> interface that
requires them to provide an implementation for such a method. The custom
<code><a href="../reference/ProgressTrackingContext.html">?ProgressTrackingContext</a></code> can <em>override</em> the <a href="https://github.com/mihaiconstantin/parabar/blob/1164f76e4b8c21a983d15b5c23ecad25bd667eaf/R/ProgressTrackingContext.R#L335-L359" class="external-link"><code>sapply</code>
method</a> above to provide progress-tracking capabilities as
follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ...</span></span>
<span></span>
<span><span class="va">sapply</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">fun</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Prepare the backend operation with early evaluated `...`.</span></span>
<span>    <span class="va">operation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>            <span class="va">super</span><span class="op">$</span><span class="va">sapply</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">fun</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Execute the task using the desired backend operation.</span></span>
<span>    <span class="va">private</span><span class="op">$</span><span class="fu">.execute</span><span class="op">(</span>operation <span class="op">=</span> <span class="va">operation</span>, fun <span class="op">=</span> <span class="va">fun</span>, total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ...</span></span></code></pre></div>
<p>We can see that the <code>sapply</code> operation is prepared as a
quoted expression that is passed to and handled by the private <a href="https://github.com/mihaiconstantin/parabar/blob/1164f76e4b8c21a983d15b5c23ecad25bd667eaf/R/ProgressTrackingContext.R#L266-L286" class="external-link">method
<code>.execute</code></a>. The <code>.execute</code> method is
responsible for ensuring that the task function is decorated to log the
progress after each task execution, and that the progress bar is
displayed and updated based on the progress reported in the log
file:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ...</span></span>
<span></span>
<span><span class="va">.execute</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">operation</span>, <span class="va">fun</span>, <span class="va">total</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Create file for logging progress.</span></span>
<span>    <span class="va">log</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="fu">.make_log</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Clear the temporary file on function exit.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="co"># Remove.</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Decorate the task function.</span></span>
<span>    <span class="va">fun</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="fu">.decorate</span><span class="op">(</span>task <span class="op">=</span> <span class="va">fun</span>, log <span class="op">=</span> <span class="va">log</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Evaluate the operation now referencing the decorated task.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">operation</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Show the progress bar and block the main process.</span></span>
<span>    <span class="va">private</span><span class="op">$</span><span class="fu">.show_progress</span><span class="op">(</span>total <span class="op">=</span> <span class="va">total</span>, log <span class="op">=</span> <span class="va">log</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ...</span></span></code></pre></div>
<p>Breaking down the implementation above, the following lines of
code</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create file for logging progress.</span></span>
<span><span class="va">log</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="fu">.make_log</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clear the temporary file on function exit.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># Remove.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><a href="https://github.com/mihaiconstantin/parabar/blob/1164f76e4b8c21a983d15b5c23ecad25bd667eaf/R/ProgressTrackingContext.R#L133-L149" class="external-link">create
a temporary file</a> where the <code>task</code> function will record
the progress after each task execution, and remove this file when the
parallel task has completed. The next line of code</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Decorate task function.</span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="fu">.decorate</span><span class="op">(</span>task <span class="op">=</span> <span class="va">fun</span>, log <span class="op">=</span> <span class="va">log</span><span class="op">)</span></span></code></pre></div>
<p><a href="https://github.com/mihaiconstantin/parabar/blob/1164f76e4b8c21a983d15b5c23ecad25bd667eaf/R/ProgressTrackingContext.R#L151-L196" class="external-link">decorates
the <code>task</code></a> function by injecting code that enables it to
record the progress in the <code>log</code> file after each execution.
Next, we evaluate the <code>operation</code> expression that contains
the call to the <code>sapply</code> method of the base
<code><a href="../reference/Context.html">?Context</a></code> class (i.e., via the <code>super</code> access
modifier). Evaluating this operation will implicitly use of the
<em>decorated</em> <code>task</code> function available in the current
environment:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Evaluate the operation now referencing the decorated task.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">operation</span><span class="op">)</span></span></code></pre></div>
<p>As mentioned earlier, this call is simply forwarded to the
<code>sapply</code> method of the <code>.backend</code> instance.
However, unlike before, the <code>task</code> function is now decorated
to log the progress to a file. Finally, the following line of code</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show the progress bar and block the main process.</span></span>
<span><span class="va">private</span><span class="op">$</span><span class="fu">.show_progress</span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, log <span class="op">=</span> <span class="va">log</span><span class="op">)</span></span></code></pre></div>
<p>simply creates a <code><a href="../reference/Bar.html">?Bar</a></code> instance to display and update a
progress bar based on the progress reported in the <code>log</code> file
(i.e., see <a href="https://github.com/mihaiconstantin/parabar/blob/1164f76e4b8c21a983d15b5c23ecad25bd667eaf/R/ProgressTrackingContext.R#L198-L264" class="external-link">source
code here</a>).</p>
<p>In summary, <code>parabar</code> enables progress-tracking for
parallel tasks by adjusting the <code>task</code> function to log to a
file each time a task has finished executing. The log file is then
monitored periodically and used to update the progress bar displayed in
the console (i.e., see also the <code>progress_timeout</code> field of
<code><a href="../reference/Options.html">?Options</a></code> for how to adjust the timeout between subsequent
checks of the log file). The benefits of this approach are two fold.
First, the progress bar will accurately reflect the execution progress
of the task. Second, this scales well to any kind of tasks (i.e., both
simple and complex). On the other hand, one potential disadvantage of
this approach is the overhead associated with the I/O for writing and
reading the execution progress.</p>
</div>
</div>
<div class="section level2">
<h2 id="progress-tracking-with-pbapply">Progress tracking with <code>pbapply</code><a class="anchor" aria-label="anchor" href="#progress-tracking-with-pbapply"></a>
</h2>
<p><a href="https://peter.solymos.org/pbapply/" class="external-link"><code>pbapply</code></a>
is a versatile package that provides progress tracking for various
backends and vectorized <code>R</code> functions in the
<code>*apply</code> family. To understand how <code>pbapply</code>
approaches progress tracking, we can take a look at the implementation
details of the <code>?pbapply::pblapply</code> function, which seems to
be the workhorse function used by the other <code>*apply</code>
variants. At the time of writing this article, the most recent version
of the function <code>?pbapply::pblapply</code> is at the commit <a href="https://github.com/psolymos/pbapply/commit/0195d7730b856b5249f294541acbe9bc0bbd626a" class="external-link"><code>0195d77</code></a>
on May 23, 2023, in the file <a href="https://github.com/psolymos/pbapply/blob/0195d7730b856b5249f294541acbe9bc0bbd626a/R/pblapply.R" class="external-link"><code>pblapply.R</code></a>.
Looking at the <a href="https://github.com/psolymos/pbapply/blob/0195d7730b856b5249f294541acbe9bc0bbd626a/R/pblapply.R#L51-L66" class="external-link">source
code lines</a> <code>51</code> to <code>66</code> in the file
<code>pblapply.R</code> we see the following code:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ...</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">cl</span>, <span class="st">"cluster"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>                                  <span class="co"># 51</span></span>
<span>    <span class="co">## switch on load balancing if needed                       # 52</span></span>
<span>    <span class="va">PAR_FUN</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"pboptions"</span><span class="op">)</span><span class="op">$</span><span class="va">use_lb</span><span class="op">)</span><span class="op">)</span>       <span class="co"># 53</span></span>
<span>        <span class="fu">parallel</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapplyLB</a></span> <span class="kw">else</span> <span class="fu">parallel</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapply</a></span>          <span class="co"># 54</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">dopb</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>                                                <span class="co"># 55</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">PAR_FUN</span><span class="op">(</span><span class="va">cl</span>, <span class="va">X</span>, <span class="va">FUN</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># 56</span></span>
<span>    <span class="co">## define split here and use that for counter               # 57</span></span>
<span>    <span class="va">Split</span> <span class="op">&lt;-</span> <span class="fu">splitpb</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>, nout <span class="op">=</span> <span class="va">nout</span><span class="op">)</span>        <span class="co"># 58</span></span>
<span>    <span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Split</span><span class="op">)</span>                                          <span class="co"># 59</span></span>
<span>    <span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu">startpb</span><span class="op">(</span><span class="fl">0</span>, <span class="va">B</span><span class="op">)</span>                                         <span class="co"># 60</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu">closepb</span><span class="op">(</span><span class="va">pb</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                            <span class="co"># 61</span></span>
<span>    <span class="va">rval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">B</span><span class="op">)</span>                                   <span class="co"># 62</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>                                     <span class="co"># 63</span></span>
<span>        <span class="va">rval</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">PAR_FUN</span><span class="op">(</span><span class="va">cl</span>, <span class="va">X</span><span class="op">[</span><span class="va">Split</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, <span class="va">FUN</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span>   <span class="co"># 64</span></span>
<span>        <span class="fu">setpb</span><span class="op">(</span><span class="va">pb</span>, <span class="va">i</span><span class="op">)</span>                                            <span class="co"># 65</span></span>
<span>    <span class="op">}</span>                                                           <span class="co"># 66</span></span>
<span><span class="co"># ...</span></span>
<span><span class="op">}</span> <span class="co"># ...</span></span></code></pre></div>
<p>Line <code>51</code> in the code snippet above is used to determine
whether the parallel backend is a <code>cluster</code> object created
via the <code>parallel</code> package. When that is the case,
<code>pbapply</code> proceeds in lines <code>53</code> and
<code>54</code> with choosing the appropriate
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parLapply</a></code> function for the parallelization
(i.e., with or without load balancing). Then, lines <code>55</code> and
<code>56</code> determine whether a progress bar should be displayed
based on the <code>dopb</code> function.</p>
<p>The more interesting part, is represented by lines <code>57</code> to
<code>66</code>, which are used to define how the progress bar will be
created and updated. More specifically, line <code>58</code> splits the
task repetitions into smaller chunks based on how many tasks we want to
run (i.e., <code>nx</code>), how many nodes are in the cluster (i.e.,
<code>ncl</code>), and the maximum number of splits we want (i.e.,
<code>nout</code>). For example, suppose we want want to run
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>20</mn><annotation encoding="application/x-tex">20</annotation></semantics></math>
tasks in parallel on a cluster with three nodes, with the default value
of <code>nout = NULL</code>. In this case, <code>pbapply</code> creates
the following splits:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create task splits.</span></span>
<span><span class="va">splits</span> <span class="op">&lt;-</span> <span class="fu">pbapply</span><span class="fu">::</span><span class="fu">splitpb</span><span class="op">(</span>nx <span class="op">=</span> <span class="fl">20</span>, ncl <span class="op">=</span> <span class="fl">3</span>, nout <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the splits.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 4 5 6</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 7 8 9</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 10 11 12</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 13 14 15</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [1] 16 17 18</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; [1] 19 20</span></span></code></pre></div>
<p>We see that <code>?pbapply::splitpb</code> produced seven splits,
each consisting of two or three task repetitions. In lines
<code>59</code> and <code>60</code> <code>pbapply</code> counts how many
splits were created and starts a progress bar with a minimum of zero and
a maximum value set to the total number of splits (i.e., seven in this
case). Even more interesting are lines <code>63</code> to
<code>66</code>. Here, <code>pbapply</code> loops over each split and
calls the selected parallel function (e.g.,
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parLapply</a></code>) with the task repetitions
corresponding to the current split processed. As soon as this parallel
function returns, the progress bar is updated with the processed split
index. Therefore, in the example above, <code>pbapply</code> will call
the parallel function seven times, and hence update the progress bar
seven times.</p>
<p>The code snippet above already provides us with two important
insights into how <code>pbapply</code> works. First, by default,
<code>pbapply</code> does not update the progress bar after each task
repetition. Second, the overhead <code>pbapply</code> adds is likely
given by the repeated calls to the parallel function (e.g.,
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parLapply</a></code>) that involves transferring the tasks
to the different processes that make up the cluster nodes.</p>
<p>We can compare this with the source code of the built-in function
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parLapply</a></code> displayed below, where we let
<code>X</code> represent our
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>20</mn><annotation encoding="application/x-tex">20</annotation></semantics></math>
task repetitions and <code>fun</code> the task function to be applied to
each repetition:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">function</span><span class="op">(</span><span class="va">cl</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">X</span>, <span class="va">fun</span>, <span class="va">...</span>, <span class="va">chunk.size</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>   <span class="co"># 1</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">defaultCluster</span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>                            <span class="co"># 2</span></span>
<span>    <span class="va">nchunks</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">:::</span><span class="fu">staticNChunks</span><span class="op">(</span>                <span class="co"># 3</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,                                      <span class="co"># 4</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>,                                     <span class="co"># 5</span></span>
<span>        <span class="va">chunk.size</span>                                      <span class="co"># 6</span></span>
<span>    <span class="op">)</span>                                                   <span class="co"># 7</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>                                            <span class="co"># 8</span></span>
<span>        <span class="va">c</span>,                                              <span class="co"># 9</span></span>
<span>        <span class="fu">clusterApply</span><span class="op">(</span>                                   <span class="co"># 10</span></span>
<span>            cl <span class="op">=</span> <span class="va">cl</span>,                                    <span class="co"># 11</span></span>
<span>            x <span class="op">=</span> <span class="fu">parallel</span><span class="fu">:::</span><span class="fu">splitList</span><span class="op">(</span><span class="va">X</span>, <span class="va">nchunks</span><span class="op">)</span>,       <span class="co"># 12</span></span>
<span>            fun <span class="op">=</span> <span class="va">lapply</span>,                               <span class="co"># 13</span></span>
<span>            FUN <span class="op">=</span> <span class="va">fun</span>,                                  <span class="co"># 14</span></span>
<span>            <span class="va">...</span>                                         <span class="co"># 15</span></span>
<span>        <span class="op">)</span>,                                              <span class="co"># 16</span></span>
<span>        quote <span class="op">=</span> <span class="cn">TRUE</span>                                    <span class="co"># 17</span></span>
<span>    <span class="op">)</span>                                                   <span class="co"># 18</span></span>
<span><span class="op">}</span>                                                       <span class="co"># 19</span></span></code></pre></div>
<p>We can see on lines <code>3</code> and <code>12</code> calls to two
internal functions of the <code>parallel</code> package, namely,
<code>parallel:::staticNChunks</code> and
<code>parallel:::splitList</code>. Applying these functions to our
example results in the following splits:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Task repetitions.</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span></span>
<span><span class="co"># Number of nodes in the cluster.</span></span>
<span><span class="va">ncl</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Compute chunk size based on that repetitions and cluster size.</span></span>
<span><span class="va">nchunks</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">:::</span><span class="fu">staticNChunks</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="va">ncl</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the chunk size.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nchunks</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span></span>
<span><span class="co"># Create the task splits.</span></span>
<span><span class="fu">parallel</span><span class="fu">:::</span><span class="fu">splitList</span><span class="op">(</span><span class="va">X</span>, <span class="va">nchunks</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4 5 6 7</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1]  8  9 10 11 12 13</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 14 15 16 17 18 19 20</span></span></code></pre></div>
<p>We see that <code>pbapply</code> uses a similar approach for creating
the task splits, however, unlike <code>pbapply</code>, the built-in
<code>parallel</code> package creates by default as many tasks splits as
nodes in the cluster. This means that the
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::clusterApply</a></code> function used within
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parLapply</a></code> will only be called three times, i.e.,
as stated in the <a href="https://stat.ethz.ch/R-manual/R-devel/library/parallel/html/clusterApply.html" class="external-link">documentation</a>:</p>
<blockquote>
<p><code>clusterApply</code> calls fun on the first node with arguments
x[[1]] and …, on the second node with x[[2]] and …, and so on, recycling
nodes as needed.</p>
</blockquote>
<p>This approach is strikingly different from <code>pbapply</code>
which, for this example, results in calling the parallel function (e.g.,
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parLapply</a></code>) seven times, which, in turn, results
in calling the <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::clusterApply</a></code> for each individual
task repetition. Put simply, for the example above, the
<code>parallel</code> package calls the
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::clusterApply</a></code> for each chunk, whereas
<code>pbapply</code> calls the <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::clusterApply</a></code> for
each task repetition. Therefore, the <code>pbapply</code> progress
tracking functionality can be regarded as a tradeoff between the
granularity of the progress bar and the overhead associated with
chunking the task repetitions and communicating with the cluster nodes.
While this overhead is likely negligible when the number of tasks is
low, such repeated calls to the <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::clusterApply</a></code> are
definitely something one should consider when scaling things up.</p>
<p>In the next section, I provide rough estimates of the overhead
associated with the progress-tracking approaches discussed above.</p>
</div>
<div class="section level2">
<h2 id="overhead">Overhead<a class="anchor" aria-label="anchor" href="#overhead"></a>
</h2>
<p>To make things as comparable as possible, I start by defining a dummy
task function that we can reliably measure how long it takes to execute.
We then run
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1000</mn><annotation encoding="application/x-tex">1000</annotation></semantics></math>
repetitions of this task in parallel via the built-in function
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parSapply</a></code> to establish the baseline execution
time. This baseline execution time serves as our benchmark for comparing
the execution times of the progress-tracking approaches discussed above
(e.g., <code>pbapply</code> and <code>parabar</code>). To obtain more
stable results, we determine the execution times based on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>100</mn><annotation encoding="application/x-tex">100</annotation></semantics></math>
replications of the parallelized task replications, and provide a
summary in the form of a figure. To achieve this, we use the <a href="https://CRAN.R-project.org/package=microbenchmark" class="external-link"><code>microbenchmark</code></a>
package for benchmarking the execution times, and the <a href="https://ggplot2.tidyverse.org" class="external-link"><code>ggplot2</code></a> package
for plotting the results.</p>
<div class="section level3">
<h3 id="the-task-function">The task function<a class="anchor" aria-label="anchor" href="#the-task-function"></a>
</h3>
<p>We start by loading the libraries needed for the benchmarks
below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load libraries.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://parabar.mihaiconstantin.com" class="external-link">parabar</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/psolymos/pbapply" class="external-link">pbapply</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>For our task, we can use the <code><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">?base::Sys.sleep</a></code> function
to simulate a task that takes a certain amount of time to execute. For
the purposes of this article, we will use a task that takes roughly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.05</mn><annotation encoding="application/x-tex">0.05</annotation></semantics></math>
milliseconds to execute and simply adds one to the input argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define task function.</span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Pretend to perform an expensive computation.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.00005</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Return the computation.</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="baseline-execution-time">Baseline execution time<a class="anchor" aria-label="anchor" href="#baseline-execution-time"></a>
</h3>
<p>Suppose that we want
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1000</mn><annotation encoding="application/x-tex">1000</annotation></semantics></math>
repetitions of the <code>task</code> function to be executed in parallel
on a cluster consisting of <em>five</em> nodes. We determine the
execution time based on the <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parSapply</a></code> function,
which will serve as our benchmark. We can establish this benchmark using
the following code:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the task repetitions.</span></span>
<span><span class="va">n_tasks</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Define the benchmark repetitions.</span></span>
<span><span class="va">n_benchmarks</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># Create a cluster of five nodes.</span></span>
<span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span>spec <span class="op">=</span> <span class="fl">5</span>, type <span class="op">=</span> <span class="st">"PSOCK"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Measure the execution time of the task function.</span></span>
<span><span class="va">duration_parallel</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="op">(</span></span>
<span>    <span class="co"># The task to benchmark.</span></span>
<span>    parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parSapply</a></span><span class="op">(</span><span class="va">cluster</span>, X <span class="op">=</span> <span class="va">n_tasks</span>, FUN <span class="op">=</span> <span class="va">task</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># Benchmark repetitions.</span></span>
<span>    times <span class="op">=</span> <span class="va">n_benchmarks</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stop the cluster.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the duration.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">duration_parallel</span>, unit <span class="op">=</span> <span class="st">"ms"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;      expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#&gt;  parallel 14.57251 14.81818 15.17978 15.01752 15.23622 22.07887   100</span></span></code></pre></div>
<p>Running our <code>task</code> in parallel via the
<code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">?parallel::parSapply</a></code> function takes on average
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>15.18</mn></mrow><annotation encoding="application/x-tex">M = 15.18</annotation></semantics></math>
milliseconds, with a standard deviation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>D</mi><mo>=</mo><mn>0.88</mn></mrow><annotation encoding="application/x-tex">SD = 0.88</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="parabar-execution-time">
<code>parabar</code> execution time<a class="anchor" aria-label="anchor" href="#parabar-execution-time"></a>
</h3>
<p>We repeat the same setup as above, but this time using the
<code>parabar</code> package. Since the end-user API prevents us from
displaying progress bars in non-interactive sessions (e.g., knitting
<code>R</code> vignettes), we can, more conveniently, use the
<code>R6</code> developer API to force progress-tracking, nevertheless.
In this case, we use the <code><a href="../reference/ProgressTrackingContext.html">?parabar::ProgressTrackingContext</a></code>
that adds progress tracking functionality to tasks executed in parallel.
To avoid issues with the progress bar not displaying correctly in a
non-interactive <code>R</code> session, we will temporarily redirect the
progress bar output to <code>/dev/null</code> (i.e., or <code>nul</code>
on <code>Windows</code>) using the <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">?base::sink</a></code> function.
Note that the progress tracking functionality is still employed (i.e.,
logging the execution progress to a file and reading the file to update
the progress bar), only the progress bar is not displayed.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a specification object.</span></span>
<span><span class="va">specification</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Specification.html">Specification</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the number of cores.</span></span>
<span><span class="va">specification</span><span class="op">$</span><span class="fu">set_cores</span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the cluster type.</span></span>
<span><span class="va">specification</span><span class="op">$</span><span class="fu">set_type</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"psock"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a backend instance that does support progress tracking.</span></span>
<span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AsyncBackend.html">AsyncBackend</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a progress-tracking context object.</span></span>
<span><span class="va">context</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ProgressTrackingContext.html">ProgressTrackingContext</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Register the backend with the context.</span></span>
<span><span class="va">context</span><span class="op">$</span><span class="fu">set_backend</span><span class="op">(</span><span class="va">backend</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start the backend.</span></span>
<span><span class="va">context</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="va">specification</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a modern bar instance.</span></span>
<span><span class="va">bar</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/BasicBar.html">BasicBar</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Register the bar with the context.</span></span>
<span><span class="va">context</span><span class="op">$</span><span class="fu">set_bar</span><span class="op">(</span><span class="va">bar</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Measure the execution time of the task function.</span></span>
<span><span class="va">duration_parabar</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="op">(</span></span>
<span>    <span class="co"># The task to benchmark.</span></span>
<span>    parabar <span class="op">=</span> <span class="op">{</span></span>
<span>        <span class="co"># Redirect the output (i.e., use `nul` for `Windows`).</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="st">"/dev/null"</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Run a task in parallel.</span></span>
<span>        <span class="va">context</span><span class="op">$</span><span class="fu">sapply</span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_tasks</span>, fun <span class="op">=</span> <span class="va">task</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Get the task output.</span></span>
<span>        <span class="va">backend</span><span class="op">$</span><span class="fu">get_output</span><span class="op">(</span>wait <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Disable the output redirection.</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># Benchmark repetitions.</span></span>
<span>    times <span class="op">=</span> <span class="va">n_benchmarks</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Close the backend.</span></span>
<span><span class="va">context</span><span class="op">$</span><span class="kw">stop</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the duration.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">duration_parabar</span>, unit <span class="op">=</span> <span class="st">"ms"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;     expr     min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#&gt;  parabar 85.3611 92.52532 99.01425 96.36281 100.6855 172.9809   100</span></span></code></pre></div>
<p>Based on the results above, we observe that running our
<code>task</code> function in parallel via <code>parabar</code>, with
progress tracking, yields an execution time of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>99.01</mn></mrow><annotation encoding="application/x-tex">M =
99.01</annotation></semantics></math> milliseconds, with a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>D</mi><mo>=</mo><mn>12.85</mn></mrow><annotation encoding="application/x-tex">SD = 12.85</annotation></semantics></math>.
Therefore, the overhead of <code>parabar</code> relative to
<code>parallel</code> is roughly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>83.83</mn><annotation encoding="application/x-tex">83.83</annotation></semantics></math>
milliseconds.</p>
</div>
<div class="section level3">
<h3 id="pbapply-execution-time">
<code>pbapply</code> execution time<a class="anchor" aria-label="anchor" href="#pbapply-execution-time"></a>
</h3>
<p>We repeat, again, the setup above, but this time using the
<code>pbapply</code> package via the <code>?pbapply::pbsapply</code>
function. Just like <code>parabar</code>, <code>pbapply</code> disables
progress tracking for non-interactive <code>R</code> sessions.
Therefore, we first need to force progress tracking, and, then, to avoid
printing issues, redirect the progress bar output to
<code>/dev/null</code> (i.e., or <code>nul</code> on
<code>Windows</code>).</p>
<details><summary>
Adjust <code>pbapply</code> options
</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get original `pbapply` options.</span></span>
<span><span class="va">pbapply_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"pboptions"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get `knitr` progress option.</span></span>
<span><span class="va">knitr_option</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"knitr.in.progress"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a copy of the `pbapply` options.</span></span>
<span><span class="va">pbapply_options_copy</span> <span class="op">&lt;-</span> <span class="va">pbapply_options</span></span>
<span></span>
<span><span class="co"># Create a copy of the `knitr` progress option.</span></span>
<span><span class="va">knitr_option_copy</span> <span class="op">&lt;-</span> <span class="va">knitr_option</span></span>
<span></span>
<span><span class="co"># Adjust the `pbapply` options to set a progress bar type.</span></span>
<span><span class="va">pbapply_options_copy</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"timer"</span></span>
<span></span>
<span><span class="co"># Adjust the `knitr` option to indicate no knitting.</span></span>
<span><span class="va">knitr_option_copy</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># Set the adjusted options.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>pboptions <span class="op">=</span> <span class="va">pbapply_options_copy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>knitr.in.progress <span class="op">=</span> <span class="va">knitr_option_copy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check whether `pbapply` will use a progress bar.</span></span>
<span><span class="fu">dopb</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</details><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a cluster of five nodes.</span></span>
<span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span>spec <span class="op">=</span> <span class="fl">5</span>, type <span class="op">=</span> <span class="st">"PSOCK"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Measure the execution time of the task function.</span></span>
<span><span class="va">duration_pbapply</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="op">(</span></span>
<span>    <span class="co"># The task to benchmark.</span></span>
<span>    pbapply <span class="op">=</span> <span class="op">{</span></span>
<span>        <span class="co"># Redirect the output (i.e., use `nul` for `Windows`).</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="st">"/dev/null"</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Run the task in parallel.</span></span>
<span>        <span class="fu">pbsapply</span><span class="op">(</span>X <span class="op">=</span> <span class="va">n_tasks</span>, FUN <span class="op">=</span> <span class="va">task</span>, cl <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Disable the output redirection.</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># Benchmark repetitions.</span></span>
<span>    times <span class="op">=</span> <span class="va">n_benchmarks</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stop the cluster.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the duration.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">duration_pbapply</span>, unit <span class="op">=</span> <span class="st">"ms"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;     expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#&gt;  pbapply 142.1083 147.3204 154.3072 151.1385 156.6055 216.7699   100</span></span></code></pre></div>
<details><summary>
Restore <code>pbapply</code> options
</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Restore the original `pbapply` options.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>pboptions <span class="op">=</span> <span class="va">pbapply_options</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Restore the original `knitr` option.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>knitr.in.progress <span class="op">=</span> <span class="va">knitr_option</span><span class="op">)</span></span></code></pre></div>
</details><p>The results above indicate that running the <code>task</code>
function in parallel via <code>pbapply</code>, with progress tracking,
has an average execution time of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>154.31</mn></mrow><annotation encoding="application/x-tex">M = 154.31</annotation></semantics></math>
milliseconds, with a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>D</mi><mo>=</mo><mn>12.4</mn></mrow><annotation encoding="application/x-tex">SD = 12.4</annotation></semantics></math>.
Based on these results, the overhead of <code>pbapply</code> relative to
<code>parallel</code> is roughly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>139.13</mn><annotation encoding="application/x-tex">139.13</annotation></semantics></math>
milliseconds.</p>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>In this section, I provide a brief summary of the differences in the
execution times between the parallelization approaches discussed above.
First, we can test whether there are significant differences in the
average execution time of <code>parabar</code> and
<code>pbapply</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract duration in milliseconds for `parabar`.</span></span>
<span><span class="va">parabar_time_ms</span> <span class="op">&lt;-</span> <span class="va">duration_parabar</span><span class="op">$</span><span class="va">time</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span></span>
<span><span class="co"># Extract duration in milliseconds for `pbapply`.</span></span>
<span><span class="va">pbapply_time_ms</span> <span class="op">&lt;-</span> <span class="va">duration_pbapply</span><span class="op">$</span><span class="va">time</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span></span>
<span><span class="co"># Test for mean differences.</span></span>
<span><span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">parabar_time_ms</span>,</span>
<span>    y <span class="op">=</span> <span class="va">pbapply_time_ms</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the test result.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; data:  parabar_time_ms and pbapply_time_ms</span></span>
<span><span class="co">#&gt; t = -30.96, df = 197.75, p-value &lt; 2.2e-16</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -58.81492 -51.77103</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y</span></span>
<span><span class="co">#&gt;  99.01425 154.30722</span></span></code></pre></div>
<p>The test statistic indicates that there are statistically significant
mean differences between the execution times of the <code>parabar</code>
(i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>99.01</mn></mrow><annotation encoding="application/x-tex">M = 99.01</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>D</mi><mo>=</mo><mn>12.85</mn></mrow><annotation encoding="application/x-tex">SD
= 12.85</annotation></semantics></math>) and <code>pbapply</code> (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>154.31</mn></mrow><annotation encoding="application/x-tex">M = 154.31</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>D</mi><mo>=</mo><mn>12.4</mn></mrow><annotation encoding="application/x-tex">SD = 12.4</annotation></semantics></math>)
packages, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>197.75</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mn>30.96</mn></mrow><annotation encoding="application/x-tex">t(197.75) = -30.96</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>&lt;</mo><mn>0.001</mn></mrow><annotation encoding="application/x-tex">p &lt; 0.001</annotation></semantics></math>.</p>
<p>Now, we can proceed to display the execution time of the different
parallelization approaches we discussed. We start with a pre-processing
step that combines all results into a data frame and computes additional
variables (e.g., the execution time in milliseconds).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create data frame from duration objects.</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="va">duration_parallel</span>,</span>
<span>    <span class="va">duration_parabar</span>,</span>
<span>    <span class="va">duration_pbapply</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create execution time column in milliseconds.</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">time_ms</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">time</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span></span>
<span><span class="co"># Create column indicating progress tracking.</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">progress</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">expr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parabar"</span>, <span class="st">"pbapply"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the data frame.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;      expr       min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#&gt;  parallel  14.57251  14.81818  15.17978  15.01752  15.23622  22.07887   100</span></span>
<span><span class="co">#&gt;   parabar  85.36110  92.52532  99.01425  96.36281 100.68546 172.98093   100</span></span>
<span><span class="co">#&gt;   pbapply 142.10834 147.32038 154.30722 151.13853 156.60555 216.76987   100</span></span></code></pre></div>
<p>Finally, we can plot the box plots of the execution times
corresponding to the different parallelization approaches we
discussed.</p>
<details><summary>
Code for plotting the results
</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the results.</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">results</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expr</span>, y <span class="op">=</span> <span class="va">time_ms</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>        <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">progress</span><span class="op">)</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.6</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">time_ms</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">time_ms</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Execution time of different parallelization approaches"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Parallelization approach"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Execution time in milliseconds"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Progress tracking"</span>,</span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#f9bcec"</span>, <span class="st">"#9aa9e3"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>            face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>            vjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">13</span></span>
<span>        <span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>            margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">10</span>, r <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">0</span>, l <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">12</span></span>
<span>        <span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>            margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">10</span>, b <span class="op">=</span> <span class="fl">0</span>, l <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">12</span></span>
<span>        <span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>            margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">5</span>, r <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">0</span>, l <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">11</span>,</span>
<span>            vjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        <span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>            margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">5</span>, b <span class="op">=</span> <span class="fl">0</span>, l <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">11</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>            size <span class="op">=</span> <span class="fl">12</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>            size <span class="op">=</span> <span class="fl">11</span></span>
<span>        <span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span></span>
<span>            linewidth <span class="op">=</span> <span class="fl">0.1</span></span>
<span>        <span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span></span>
<span>            linewidth <span class="op">=</span> <span class="fl">0.1</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</details><p><img src="comparison-benchmarks-1.png" alt="plot of chunk benchmarks" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this article, I discussed different approaches for adding
progress-tracking functionality to parallelized <code>R</code> code, and
showed that the <code>parabar</code> package is a good alternative to
<code>pbapply</code> for achieving this. The <code>parabar</code>
package demonstrated better performance over the <code>pbapply</code> in
terms of execution time (i.e., when the number of tasks to run is large
enough relative to the number of nodes in the cluster). Execution time
aside, <code>parabar</code> also provides more granular progress bars
that reflect the actual progress of the task, rather than the progress
of the parallelization process. Despite the name, <code>parabar</code>
is more than just a package that adds progress bars for parallelized
<code>R</code> code. Through its design, it provides a standardized way
of interacting with the built-in <code>parallel</code> package. On top
of that, it proposes an extensible mechanism to augment the
<code>parallel</code> package functions with new functionality. This is
a key benefit that allows one to customize the parallelization process
in many different ways, such as sending an email when the parallelized
task is finished executing. Therefore, the progress tracking
functionality discussed in this article is just one example of what is
possible with <code>parabar</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://mihaiconstantin.com" class="external-link">Mihai Constantin</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
